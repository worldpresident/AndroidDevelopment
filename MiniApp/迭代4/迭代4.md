## 团购小程序文档

张琛瑞 1913157



#### 一、应用场景分析

​	作为一位武汉人，我从疫情爆发以来就首当其冲地受到影响。在封城期间，生活物资的供应主要依靠社区团购来获取。但是，传统的在微信群内接龙的方式并不高效，统计起来比较麻烦，且很容易漏看错看，导致获取物资的机会浪费或是物资浪费。不仅如此，在本次上海疫情期间，有很多团长通过个人关系获得物资购买的渠道，但是这样的团购却无法使用到便捷的小程序。基于以上的背景，我决定开发一款社区团购小程序，帮助人们在封城期间更方便地进行团购。



#### 二、功能介绍

1.发起团购

我们可以作为团长，发起团购。

2.分享团购

可以将团购信息分享给好友，让好友也参加本次团购。

3.团购状态（暂停、结束、取消团购）

作为团长，可以进行对团购状态的管理。

4.联系团长

我们可以通过电话联系到团长询问具体情况。

5.查看我的团购

6.订单管理

7.导出订单

8.修改团购



#### 三、技术与方法介绍

1.发起团购

​	团购有许多商品参数，例如主题、商品名、价格和描述图片等等。在新建商品时会将商品信息存取到数据库中。

​	在发起团购时，将这些参数通过params传递，调用updateCommodity()函数，函数内部的wedaCreate()方法进行数据的插入，创建开团信息。再使用createCommodity()函数，函数内部的wedaUpdate()方法进行数据的更新，实现团购信息的上传。然后会进行数据校验，如果检测到商品信息、团购标题、团长电话没有填写，那么会调用showToast弹出提示框，提醒用户完成信息的填写。



2.分享团购

​	在Index页的lifecycle中添加onShareAppMessage()函数，即可使用微信小程序的分享功能。



3.修改团购状态

​	为了方便记录订单状态，定义了全局常量groupStatus来表示订单当前状态。1代表进行中，2代表暂停中，3代表已完成，4代表已取消。在用户选择改变订单状态时，会使用wedaUpdate()来修改数据库中存储的订单状态的代号。需要注意的是，我们的订单只有在进行状态下可以暂停，也只有在进行状态下可以取消和完成。当当前状态和用户需要改变的状态出现矛盾时，会调用showToast弹出提示框进行提醒。



4.联系团长

​	调用callPhone()，跳转到手机的拨号页面，自动填入团长预留的手机号，需要用户手动操作进行拨打，咨询团购相关问题。



5.查看我的团购

​	查看已参加的团购详情，需要调用currentOrderList内的数据，将团购标题、下单时间、商品数量和规格、单价和总价等数据进行展示。此外，为了查看不同状态的订单，将数据的status进行筛选即可，1代表待收货，2代表已收货。若暂时没有符合筛选条件的订单则显示“没用符合条件的订单”。这样就可以轻松地查看所有订单及不同状态的订单。

​	查看我发起的团购详情，需要调用currentCommodityList内的数据，将团购标题、下单时间、商品数量和规格、单价和总价等数据进行展示。此外，为了查看不同状态的订单，将数据的status进行筛选即可，1代表待收货，2代表已收货若暂时没有符合筛选条件的订单则显示“没用符合条件的订单”。这样就可以轻松地查看所有订单及不同状态的订单。



6.订单管理

​	在我发起的团购页面内，即可进入订单管理。在这里可以看到我发起的团购里面所有参与者的订单详情，也可以分为待收货和已收货进行分类查看。

​	技术实现和”查看我的团购“类似，但增加了修改订单状态的功能，可以将待收货的订单修改为已收货。也就是说，只能在订单管理中进行订单配送状态的更改。



7.导出订单

​	由于将所有订单打印后进行统计和勾画更加方便，因此加入了这个导出订单为excel表格的功能。

​	首先，将 groupInfo、openId和groupId赋值，并使用groupInfo的数据进行文件的生成。此时显示“导出中”。

​	生成文件成功后，通过app.cloud.getTempFileURL()获取临时文件的url，使用wx.downloadFile()将文件下载到本地。最后再使用wx.openDocument()将xls文档打开，展示给团长。



8.修改团购

​	在团购发起后，有时需要对团购详情或团购的商品进行增补或修改，这时就可以使用这个功能。

​	首先会判断团购状态，当团购结束时是不可以修改团购内容的。如果判断为可以修改，那么团长就可以修改内容，点击确认修改。此时分为三种情况：修改、增加和删除。如果是修改，那么商品数量不变。如果是增加，那么item.number+1，如果是删除，那么item.number-1。并将修改后的数据存入缓存cacheCommodityList中。最后再将cacheCommodityList上传到commodityList中即修改成功。



#### 四、功能展示

详见演示视频

